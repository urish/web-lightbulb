"use strict";!function(t){var e=function(t,e,i){t.addEventListener(e,i,!1)},i=function(t){"complete"===document.readyState?t():document.addEventListener("readystatechange",function e(i){"complete"===i.target.readyState&&(t(),i.target.removeEventListener("readystatechange",e))},!1)},r=/MSIE ([0-9]+)/g.test(navigator.userAgent),s=function(){function t(t){var e=t.r,i=t.g,r=t.b,s=Math.max(e,i,r),a=Math.min(e,i,r),n=s-a,h,o=0===s?0:n/s,l=s/255;switch(s){case a:h=0;break;case e:h=i-r+n*(i<r?6:0),h/=6*n;break;case i:h=r-e+2*n,h/=6*n;break;case r:h=e-i+4*n,h/=6*n}return{h:~~(360*h),s:~~(100*o),v:~~(100*l)}}function e(t){var e=t.s/100,i=t.l/100;return e*=i<.5?i:1-i,{h:t.h,s:~~(2*e/(i+e)*100),v:~~(100*(i+e))}}function i(t){t=t.replace(/#/g,"");var e=~~("0x"+t);return 3===t.length?{r:17*(e>>8),g:17*(e>>4&15),b:17*(15&e)}:{r:e>>16,g:e>>8&255,b:255&e}}function r(t){return this instanceof r?(this._watchCallback,this._hsv={},this._oldHsv={h:void 0,s:void 0,v:void 0},Object.defineProperties(this,{hsv:{set:this.setHsv,get:function(){return this._hsv},enumerable:!0},hexString:{set:this.setFromString,get:this.getHexString,enumerable:!0},rgb:{set:this.setRgb,get:this.getRgb,enumerable:!0},rgbString:{set:this.setFromString,get:this.getRgbString,enumerable:!0},hsl:{set:this.setHsl,get:this.getHsl,enumerable:!0},hslString:{set:this.setFromString,get:this.getHslString,enumerable:!0}}),void(t&&this.setFromString(t))):new r(t)}var s=r.prototype;return s.watch=function(t){this._watchCallback=t},s.unwatch=function(){this._watchCallback=void 0},s.setHsv=function(t){var e={};for(var i in this._oldHsv)t.hasOwnProperty(i)||(t[i]=this._oldHsv[i]),e[i]=!(t[i]==this._oldHsv[i]);this._hsv=t,(e.h||e.s||e.v)&&"function"==typeof this._watchCallback&&this._watchCallback(t,this._oldHsv,e),this._oldHsv=t},s.setRgb=function(e){this.hsv=t(e)},s.setHsl=function(t){this.hsv=e(t)},s.setFromString=function(r){var s=r.match(/(^rgba?|^hsla?)(?=\(.*?\))|(^#)(?=[a-f0-9])/i),a;switch(s?s[0]:null){case"#":this.hsv=t(i(r));break;case"rgb":case"rgba":a=r.match(/(rgba?)\((\d+)(?:\D+?)(\d+)(?:\D+?)(\d+)(?:\D+?)?([0-9\.]+?)?\)/i),this.hsv=t({r:parseInt(a[2]),g:parseInt(a[3]),b:parseInt(a[4])});break;case"hsl":case"hsla":a=r.match(/(hsla?)\((\d+)(?:\D+?)(\d+)(?:\D+?)(\d+)(?:\D+?)?([0-9\.]+?)?\)/i),this.hsv=e({h:parseInt(a[2]),s:parseInt(a[3]),l:parseInt(a[4])});break;default:console.warn("Error: '",r,"' could not be parsed as a CSS color")}},s.getRgb=function(){var t=this.hsv,e,i,r,s,a,n,h,o,l=t.h/360,c=t.s/100,u=t.v/100;switch(s=Math.floor(6*l),a=6*l-s,n=u*(1-c),h=u*(1-a*c),o=u*(1-(1-a)*c),s%6){case 0:e=u,i=o,r=n;break;case 1:e=h,i=u,r=n;break;case 2:e=n,i=u,r=o;break;case 3:e=n,i=h,r=u;break;case 4:e=o,i=n,r=u;break;case 5:e=u,i=n,r=h}return{r:~~(255*e),g:~~(255*i),b:~~(255*r)}},s.getRgbString=function(){var t=this.rgb;return[t.a?"rgba":"rgb","(",t.r,", ",t.g,", ",t.b,t.a?", "+t.a:"",")"].join("")},s.getHexString=function(t){var e=this.rgb,i,r;return t&&e.r%17===0&&e.g%17===0&&e.b%17===0?(i=e.r/17<<8|e.g/17<<4|e.b/17,r=4):(i=e.r<<16|e.g<<8|e.b,r=7),"#"+function(t){return new Array(r-t.length).join("0")+t}(i.toString(16))},s.getHsl=function(){var t=this.hsv,e=t.s/100,i=t.v/100,r=(2-e)*i;return e=0==e?0:e*i/(r<1?r:2-r),{h:t.h,s:~~(100*e),l:~~(50*r)}},s.getHslString=function(){var t=this.hsl;return[t.a?"hsla":"hsl","(",t.h,", ",t.s,"%, ",t.l,"%",t.a?", "+t.a:"",")"].join("")},r}(),a=function(){var t,e={},i;return{snakeCase:function(t){return t.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()})},getSheet:function(){if(!t){var e=document.createElement("style");e.appendChild(document.createTextNode("")),e.title="iroStyleSheet",document.head.appendChild(e),t=e.sheet,i=void 0!=t.insertRule}return t},getRules:function(){var t=this.getSheet();return t.rules||t.cssRules},setRule:function(r,s,a){var n=this.getRules();if(s=this.snakeCase(s),e.hasOwnProperty(r))n[e[r]].style.setProperty(s,a);else{var h=n.length;i?t.insertRule([r," {",s,": ",a,";}"].join(""),h):t.addRule(r,[s,": ",a].join(""),h),e[r]=h}}}}(),n=function(){function n(t){c&&c._inputMove(t)}function h(t){c&&(t.preventDefault(),c._target=void 0,c=void 0)}function o(t,e,i,r){var s=document.createElement("canvas"),a=t*i,n=e*i;s.width=a,s.height=n,s.style.cssText+="width:"+t+"px;height"+e+"px";var h=a/t;return s.getContext("2d").scale(i,i),r&&(s.style.cssText+="position:absolute;top:0;left:0"),s}function l(r,a){if(!(this instanceof l))return new l(r,a);this.el="string"==typeof r?document.querySelector(r):r;var n=a.width||parseInt(this.el.getAttribute("width"))||320,h=a.height||parseInt(this.el.getAttribute("height"))||320,c=t.devicePixelRatio||1;this.width=n,this.height=h,this.pxRatio=c,this.el.style.position="relative",this.main=this.el.appendChild(o(n,h,c,!1)),this.mainCtx=this.main.getContext("2d"),this.overlay=this.el.appendChild(o(n,h,c,!0)),this.overlayCtx=this.overlay.getContext("2d"),this._layout=this._solveLayout(a||{}),this._drawSlider(),this.styles=a.css||a.styles||void 0,this._watchCallback=a.watchCallback||void 0,this._overlayMarkers={},this._target,i(function(){var t=this.el;e(t,"touchstart",this._inputStart.bind(this)),e(t,"mousedown",this._inputStart.bind(this))}.bind(this)),this.color=s(),this.color.watch(this._update.bind(this)),this.color.watch=this.color.unwatch=void 0,this.color.setFromString(a.color||"#fff")}var c;i(function(){var t=document.body;e(t,"touchmove",n),e(t,"touchend",h),e(t,"mousemove",n),e(t,"mouseup",h)}.bind(this));var u=l.prototype;return u._solveLayout=function(t){var e=t.padding+2||6,i=t.sliderMargin||24,r=t.markerRadius||8,s=t.sliderHeight||2*r+2*e,a=Math.min(this.height-s-i,this.width),n=(this.width-a)/2;return{Mr:r,Rd:a,Rr:a/2,Re:a/2-(r+e),Rcx:n+a/2,Rcy:a/2,Rx1:n,Rx2:n+a,Ry1:0,Ry2:a,Sw:a,Sh:s,Sr:s/2,Srw:a-s,Srs:n+s/2,Sre:n+a-s/2,Sx1:n,Sx2:n+a,Sy1:a+i,Sy2:a+s+i,isPointInSlider:function(t,e){return t>this.Sx1&&t<this.Sx2&&e>this.Sy1&&e<this.Sy2},isPointInRing:function(t,e){var i=Math.abs(t-this.Rcx),r=Math.abs(e-this.Rcy);return Math.sqrt(i*i+r*r)<this.Rr}}},u.resize=function(t){t&&t.width&&t.height&&(this.mainCtx.clearRect(0,0,this.width,this.height),this.main.width=this.overlay.width=this.width=t.width,this.main.height=this.overlay.height=this.height=t.height,this._layout=this._solveLayout(t),this._drawSlider(),this._update(this.color.hsv,null,{h:!0,s:!0,v:!0}))},u.watch=function(t){this._watchCallback||"function"!=typeof t||(this._watchCallback=t)},u.unwatch=function(){this._watchCallback=void 0},u._inputHandler=function(t,e){var i=this._layout;if("slider"==this._target)t=Math.max(Math.min(t,i.Sre),i.Srs)-i.Srs,this.color.hsv={v:~~(100/i.Srw*t)};else if("ring"==this._target){var r=Math.atan2(t-i.Rcx,e-i.Rcy),s=360-~~((r*(180/Math.PI)+270)%360),a=Math.min(Math.sqrt((i.Rcx-t)*(i.Rcx-t)+(i.Rcy-e)*(i.Rcy-e)),i.Re);this.color.hsv={h:s,s:~~(100/i.Re*a)}}},u._inputStart=function(t){t.preventDefault(),t=t.touches?t.changedTouches[0]:t;var e=this.main.getBoundingClientRect(),i=t.clientX-e.left,r=t.clientY-e.top;if(this._layout.isPointInSlider(i,r))this._target="slider";else{if(!this._layout.isPointInRing(i,r))return!1;this._target="ring"}c=this,this._inputHandler(i,r)},u._inputMove=function(t){if(c){t.preventDefault(),t=t.touches?t.changedTouches[0]:t;var e=this.main.getBoundingClientRect();this._inputHandler(t.clientX-e.left,t.clientY-e.top)}},u._drawMarkerRing=function(t,e,i,r){var s=this.overlayCtx;s.lineWidth=r,s.beginPath(),s.strokeStyle=i,s.arc(t,e,this._layout.Mr,0,2*Math.PI),s.stroke()},u._drawMarker=function(t,e){this._drawMarkerRing(t,e,"#333",4),this._drawMarkerRing(t,e,"#fff",2)},u._updateMarker=function(t,e,i){this._overlayMarkers[t]={x:e,y:i},this.overlayCtx.clearRect(0,0,this.width,this.height),this._overlayMarkers.ring&&this._drawMarker(this._overlayMarkers.ring.x,this._overlayMarkers.ring.y),this._overlayMarkers.slider&&this._drawMarker(this._overlayMarkers.slider.x,this._overlayMarkers.slider.y)},u._drawWheel=function(t){var e=this._layout,i=this.mainCtx;i.lineWidth=Math.round(1+e.Rd/100),i.clearRect(e.Rx1,e.Ry1,e.Rd,e.Rd);for(var r=0;r<360;r++){var s=r*Math.PI/180;i.beginPath(),i.strokeStyle=["hsl(",r,", 100%, ",t/2,"%)"].join(""),i.moveTo(e.Rcx,e.Rcy),i.lineTo(e.Rcx+e.Rr*Math.cos(s),e.Rcy+e.Rr*Math.sin(s)),i.stroke()}var a=i.createRadialGradient(e.Rcx,e.Rcy,2,e.Rcx,e.Rcy,e.Re);a.addColorStop(0,"hsla(0, 0%, "+t+"%, 1)"),a.addColorStop(1,"hsla(0, 0%, "+t+"%, 0)"),i.fillStyle=a,i.fillRect(e.Rx1,e.Ry1,e.Rd,e.Rd)},u._drawSlider=function(){var t=this._layout,e=this.mainCtx,i=e.createLinearGradient(t.Sx1,t.Sy1,t.Sx2,t.Sy1);i.addColorStop(0,"#000"),i.addColorStop(1,"#fff"),e.fillStyle=i,e.clearRect(t.Sx1,t.Sy1,t.Sw,t.Sh),e.beginPath(),e.moveTo(t.Sx1+t.Sr,t.Sy1),r?(e.lineTo(t.Sx2-t.Sr,t.Sy1),e.quadraticCurveTo(t.Sx2,t.Sy1,t.Sx2,t.Sy1+t.Sr),e.lineTo(t.Sx2,t.Sy2-t.Sr),e.quadraticCurveTo(t.Sx2,t.Sy2,t.Sx2-t.Sr,t.Sy2),e.lineTo(t.Sx1+t.Sr,t.Sy2),e.quadraticCurveTo(t.Sx1,t.Sy2,t.Sx1,t.Sy2-t.Sr),e.lineTo(t.Sx1,t.Sy1+t.Sr),e.quadraticCurveTo(t.Sx1,t.Sy1,t.Sx1+t.Sr,t.Sy1)):(e.arcTo(t.Sx2,t.Sy1,t.Sx2,t.Sy2,t.Sr),e.arcTo(t.Sx2,t.Sy2,t.Sx1,t.Sy2,t.Sr),e.arcTo(t.Sx1,t.Sy2,t.Sx1,t.Sy1,t.Sr),e.arcTo(t.Sx1,t.Sy1,t.Sx2,t.Sy1,t.Sr)),e.closePath(),e.fill()},u._update=function(t,e,i){var r=this._layout;if("function"==typeof this._watchCallback&&this._watchCallback.call(null,this.color,i),i.v){this._drawWheel(t.v);var s=t.v/100*r.Srw;this._updateMarker("slider",r.Srs+s,r.Sy1+r.Sh/2)}if(i.h||i.s){var n=i.h?t.h:e.h,h=i.s?t.s:e.s,o=n*(Math.PI/180),l=h/100*r.Re;this._updateMarker("ring",r.Rcx+l*Math.cos(o),r.Rcy+l*Math.sin(o))}if(this.styles){var c=this.color.getRgbString(),u=this.styles;for(var d in u){var S=u[d];for(var v in S)a.setRule(d,v,c)}}},l}(),h={StylesheetWriter:a,Color:s,ColorWheel:n};"function"==typeof define&&define.amd?define(h):"object"==typeof exports?module.exports=h:t.iro=h}(window);